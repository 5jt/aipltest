 Run←{
    ⍝ Run tests in ##.tests for functions in ##.fun
    ⍝ ⍵: function names to test (empty=all)
    ⍝ Prints summary and writes detailed logs to logs/{fn}.log
    ⍝ Returns counts: pass fail broke

    ⍝ Constants
     ROOTDIR←'/Users/sjt/Projects/aipltest/'
     LOGDIR←ROOTDIR,'logs/'
     TESTNS←##.tests
     FUNNS←##.fun

    ⍝ Identify functions to test
     fns←(⊃∩/FUNNS TESTNS{⍺.⎕NL ⍵}¨-3 2){
         0=≢⍵:⍺
         _←{0=≢⍵:'' ⋄ ''⊣⎕←'Not found: ',⍕⍵}⍵~⍺
         ⍺∩⍵
     },¨⍵

     0=≢fns:0 0 0⊣⎕←'No tests found'

     et←(⊂¨fns)execTest¨¨TESTNS ⎕VGET fns ⍝ executed tests

     logs←⊃∘(,/)¨reportTest¨¨et
     _←logs ⎕NPUT¨LOGDIR∘{(⍺,⍵,'.log' ⋄ 1)}¨fns

     pf←+⌿table←↑{+/1 0∘.=⍵}¨et.pass
     ⎕←'' 'pass' 'fail'⍪(fns,table)⍪(⊂'TOTAL'),pf

     pf ⍝ pass fail counts
 }
